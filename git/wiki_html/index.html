<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javascript" src="theme/scripts/jquery-1.4.2.min.js"></script>

<link type="text/css" rel="stylesheet" href="hl-code/styles/shCore.css"/>
<link type="text/css" rel="stylesheet" href="hl-code/styles/shCoreRDark.css"/>
<link type="text/css" rel="stylesheet" href="hl-code/styles/shThemeRDark.css"/>
<script type="text/javascript" src="hl-code/scripts/shCore.js"></script>
<script type="text/javascript" src="hl-code/scripts/shAutoloader.js"></script>

<link type="text/css" rel="stylesheet" href="theme/styles/style.css" />

<script type="text/javascript" src="theme/scripts/script.js"></script>


<title>Git入门</title>
</head>
<body>




<h1>Git入门</h1>
<div class="toc">
<ul>
<li><a href="#toc_1">配置</a>
<ul>
<li><a href="#toc_1.1">初始化个人信息</a>
</ul>
<li><a href="#toc_2">代码托管服务商GitHub</a>
<ul>
<li><a href="#toc_2.1">在GitHub上新建一个项目</a>
<li><a href="#toc_2.2">导出一个GitHub上已经存在的项目</a>
</ul>
<li><a href="#toc_3">基本项目操作</a>
<ul>
<li><a href="#toc_3.1">新建立一个工程</a>
<li><a href="#toc_3.2">拷贝过来的工程</a>
<li><a href="#toc_3.3">忽略指定文件</a>
</ul>
<li><a href="#toc_4">基本概念</a>
<ul>
<li><a href="#toc_4.1">提交状态</a>
<li><a href="#toc_4.2">提交修改</a>
<li><a href="#toc_4.3">回退</a>
<li><a href="#toc_4.4">关于提交、回退与状态的概念图</a>
</ul>
<li><a href="#toc_5">分支控制</a>
<ul>
<li><a href="#toc_5.1">查看分支</a>
<li><a href="#toc_5.2">新建分支</a>
<li><a href="#toc_5.3">切换分支</a>
<li><a href="#toc_5.4">合并分支</a>
</ul>
<li><a href="#toc_6">合作开发</a>
<ul>
<li><a href="#toc_6.1">从仓库复制源代码到本地</a>
<li><a href="#toc_6.2">发布本地提交的内容</a>
<li><a href="#toc_6.3">取得其他人提交的内容</a>
<li><a href="#toc_6.4">冲突处理</a>
</ul>
<li><a href="#toc_7">查看提交记录</a>
</ul>
</div>


<h1 id="toc_1">配置</h1>

<h2 id="toc_1.1">初始化个人信息</h2>

<pre class="brush: bash">
git config --global user.name "Jade Shan"
git config --global user.email aaa@bbb.com
</pre>
 
 
<h1 id="toc_2">代码托管服务商GitHub</h1>

<p>
先要申请账号，建立自己的repo。
</p>

<p>
然后上传自己的ssh-key作为连接凭证。上传后检查是否能成功连接：
</p>
<pre class="brush: bash">
ssh -T git@github.com
</pre>

<p>
如果失败，用debug方式检查一下是不是因为防火墙的原因：
</p>
<pre class="brush: bash">
ssh -vT git@github.com
</pre>

<p>
还有一个失败的可能性是因为没有把私钥加上：
</p>
<pre class="brush: bash">
ssh-add ~/.ssh/id_rsa
</pre>

<p>
验证可能成功连接后，把repo复制下来：
</p>
<pre class="brush: bash">
git clone git@github.com:Jade-Shan/Jade-Wubi.git
</pre>

<p>
复制下来的第一次提交声明提交到来源：
</p>
<pre class="brush: bash">
git push origin master
</pre>

<p>
以后的直接push就可以了：
</p>
<pre class="brush: bash">
git push
</pre>

<h2 id="toc_2.1">在GitHub上新建一个项目</h2>

<pre class="brush: bash">
  mkdir study
  cd study
  git init
  touch README
  git add README
  git commit -m 'first commit'
  git remote add origin git@github.com:Jade-Shan/study.git
  git push -u origin master
</pre>
      

<h2 id="toc_2.2">导出一个GitHub上已经存在的项目</h2>

<pre class="brush: bash">
  cd existing_git_repo
  git remote add origin git@github.com:Jade-Shan/study.git
  git pull -u origin master
</pre>
      
      
<h1 id="toc_3">基本项目操作</h1>

<ul>
<li>
工作区（working tree）就是本地的代码。

<li>
快照（snapshot）建立索引（index）。

<li>
提交到仓库。

</ul>

<h2 id="toc_3.1">新建立一个工程</h2>

<pre class="brush: bash">
cd workspace/wubi
git init              # 初始化
git add .             # 目建立快照的索引
git commit            # 提交修改
</pre>

<p>
初始化一个新的工程，会建立.git目录保存信息。add为当前项目建立快照（snapshot）的索引（index file）。
</p>

<p>
提交时会在编辑器里要求输入备注。但是要注意第一行要少于50字，如果有第二行，一定要空白。
</p>

<h2 id="toc_3.2">拷贝过来的工程</h2>

<p>
拷贝过来的工程目录中要带上<code>.git</code>目录，然后执行<code>git init</code>就会重新恢复版本库为可用状态了。
</p>

<h2 id="toc_3.3">忽略指定文件</h2>

<p>
有很多文件是我们不想放到版本库中的，比如编辑过程中的临时文件或是程序构建中的临时文件。可以在项目根目录下的<code>.gitignore</code>文件中指定排除规则：
</p>

<pre class="brush: bash">
*.a           # 忽略所有.a结尾的文件
!lib.a        # 但不包括 lib.a
/TODO         # 仅忽略项目根目录下的 TODO 文件，不包括 subdir/TODO
build/        # 忽略 build/ 目录下的所有文件
doc/*.txt     # 忽略如 doc/aa.txt，但不包括 doc/subdir/aa.txt
</pre>

<h1 id="toc_4">基本概念</h1>

<p>
对于git来说，可以理解为有三个工作区：
</p>

<ul>
<li>
Workint Tree：就是现在正在开发的项目。

<li>
Snapshot Index：快照／索引。就是一个缓冲区，让用户准备哪些东西要提交到版本库。

<li>
HEAD：就是版本库。

</ul>

<h2 id="toc_4.1">提交状态</h2>

<ul>
<li>
Untracked files：新增加的没有加入版本库跟踪的文件。

<li>
Change but not update：有一部分文件有修改，还没有index。

<li>
Changes to be update：有一部分文件已经index，还没有commit。

</ul>

<h2 id="toc_4.2">提交修改</h2>

<p>
查看当前文件（work tree）和索引（index file）的区别：
</p>

<pre class="brush: bash">
git diff
</pre>

<p>
在提交这前，先把改动添加到index file：
</p>
<pre class="brush: bash">
git add readme.txt
</pre>

<p>
查看index file和版本库之间的差别：
</p>
<pre class="brush: bash">
git diff --cached
</pre>

<p>
查看文件和版本库之间的差别：
</p>
<pre class="brush: bash">
git diff HEAD
</pre>

<p>
提交更新的内容到版本库：
</p>
<pre class="brush: bash">
git commit
</pre>

<p>
可以省略比对和快照的过程，直接一次提交所有的变更。但仅提交现有的文件，新文件还是要git add：
</p>
<pre class="brush: bash">
git commit -a
</pre>

<p>
在检查修改内容的过程中，还可以查看当前工作的状态：
</p>
<pre class="brush: bash">
git status
</pre>

<p>
如果要删除一个文件，要先用<code>git rm</code>命令。如果只在文件系统上删除而没有<code>git rm</code>的话，只会让这个文件的状态回到<code>Change but not update</code>状态。
</p>

<h2 id="toc_4.3">回退</h2>

<p>
soft表示回退到index，<code>HEAD^</code>指定上一个版本：
</p>

<pre class="brush: bash">
git reset --soft
</pre>

<p>
默认的位置是mixed，回到工作版本：
</p>

<pre class="brush: bash">
git reset --mixed
git reset
</pre>

<p>
hard会把所有位置中的版本都回退掉：
</p>

<pre class="brush: bash">
git reset --hard
</pre>

<p>
<code>-- 文件名</code>从版本库中去除文件：
</p>

<pre class="brush: bash">
git reset -- src/aa.c
</pre>


<h2 id="toc_4.4">关于提交、回退与状态的概念图</h2>

<p>
<img src="images/git.commit.png" />
</p>



<h1 id="toc_5">分支控制</h1>

<h2 id="toc_5.1">查看分支</h2>

<p>
显示所有的分支：
</p>
<pre class="brush: bash">
git branch
</pre>

<p>
查看当前所在的分支及提交记录：
</p>
<pre class="brush: bash">
git-show-branch
</pre>

<h2 id="toc_5.2">新建分支</h2>

<p>
想要建一个新的叫experimenal的分支：
</p>
<pre class="brush: bash">
git branch experienal
</pre>

<h2 id="toc_5.3">切换分支</h2>

<p>
在切换分支之前要保证当前分支处于commit状态。
</p>

<p>
切换到experimenal分支：
</p>

<pre class="brush: bash">
git checkout experimenal
</pre>


<p>
使用checkout可以在多个分支上随意切换。在一个分支上的操作不会影响到另一个分支。
</p>

<p>
可以把分支的创建与切换合并为一步：
</p>
<pre class="brush: bash">
git checkout -b experimenal
</pre>

<h2 id="toc_5.4">合并分支</h2>

<p>
两个分支必须都已经commit才能合并。
</p>

<p>
要把experimenal合并到master，要先切到master：
</p>

<pre class="brush: bash">
git checkout master
</pre>

<p>
然后把experimenal合并过来：
</p>

<pre class="brush: bash">
git merge experimenal
</pre>

<p>
如果有冲突，会把冲突中的文件修改为diff格式的状态。要手动修正了以后再提交：
</p>

<pre class="brush: bash">
git commit -a
</pre>

<p>
可以通过图型界面查看分支过程：
</p>

<pre class="brush: bash">
gitk
</pre>

<p>
合并成功了以后可以删除原来的experimenal：
</p>
<pre class="brush: bash">
git branch -d experimenal
</pre>

<p>
如果分支还没有合并，可以用大写-D表示强制删除，通常在分支失败时用：
</p>
<pre class="brush: bash">
git branch -D experimenal
</pre>


<h1 id="toc_6">合作开发</h1>
 
<p>
假设现在有另一个人（用户B）和我合作。他的工作目录在：
</p>

<pre class="brush: bash">
mkdir wubi2
</pre>

<h2 id="toc_6.1">从仓库复制源代码到本地</h2>

<p>
用户B从我的版本库中导出。
</p>

<p>
在没有服务器的情况下：
</p>
<pre class="brush: bash">
git clone wubi wubi2
</pre>

<p>
通过服务器：
</p>

<pre class="brush: bash">
git clone git://git.jade.com/wubi wubi2
</pre>

<p>
然后别人可以在我的代码基础上进行开发，然后提交：
</p>
<pre class="brush: bash">
git commit -a
</pre>

<h2 id="toc_6.2">发布本地提交的内容</h2>

<p>
用户B提交的内容只有自己能看到，他想让别人得到他的工作成果的话，就要把他提交的内容发布给其他开发者。
</p>

<p>
如果服务器允许直接发布，那可以直接发布到服务器：
</p>

<pre class="brush: bash">
git push
</pre>

<p>
有些项目（如：linux kernel）不允许提交到版本库，只能做成补丁文件发邮件给别人：
</p>

<pre class="brush: bash">
git format-patch origin
</pre>


<h2 id="toc_6.3">取得其他人提交的内容</h2>

<p>
回到我这边，我知道别人已经提交了，现在要取得别人的工作成果。如果不放心别人的工作，根据别人的远程仓库名为master的分支在本地建立一个名为otherone的分支。
</p>

<p>
在没有服务器的情况下：
</p>

<pre class="brush: bash">
cd wubi
git fetch ../wubi2 master:otherone
</pre>

<p>
有服务器的情况下（区别就是源地址，以后不再说明没有服务器的情况了）：
</p>

<pre class="brush: bash">
cd wubi
git fetch git://git.jade.com/wubi master:otherone
</pre>


<p>
比较一下别人改了哪些地方
</p>
<pre class="brush: bash">
git whatchanged -p master..otherone
</pre>

<p>
如果认为对方改错了，可以删除掉对方的修改
</p>
<pre class="brush: bash">
git branch -D otherone
</pre>

<p>
如果觉得没有问题了可以用pull命令导入别人的修改。其实pull命令相当于是fetch命令和merge命令的一个组合。当然如果信任对方的话，也可以不建立分支检查（略过上面的所有步骤）直接导入。
</p>

<p>
从目录：
</p>

<pre class="brush: bash">
git pull ../wubi2 master
</pre>

<p>
从服务器：
</p>

<pre class="brush: bash">
git pull git://git.jade.com/wubi master
</pre>

<p>
从服务器也可以不加参数，直接：
</p>

<pre class="brush: bash">
git pull
</pre>

<p>
其实，用“<code>git pull .</code>”就相当于“<code>git merge</code>”。
</p>


<p>
用户B继续开发时先要取得我的工作成果，可以直接pull不用加参数。因为clone的时候已经记住了来源：
</p>
<pre class="brush: bash">
git pull
</pre>

<h2 id="toc_6.4">冲突处理</h2>

<p>
合作开发与合并分支都有可能发生冲突，看到如下错误信息：
</p>

<p>
Automatic merge failed; fix conflicts and then commit the result.
</p>

<p>
这个时候要手动排除冲突，源代码被会git修改。以“====”分隔冲突的两边。修改完成了以后可以再次提交：
</p>
<pre class="brush: bash">
git commit -a
</pre>


<h1 id="toc_7">查看提交记录</h1>

<p>
查看提交的记录，每一次提交都有一个唯一的主键叫commit：
</p>

<pre class="brush: bash">
git log
</pre>

<p>
加上参数-p可以显示详细日志信息，如提交的改动：
</p>

<pre class="brush: bash">
git log -p
</pre>

<p>
可以通过commit的值查看当次提交的详细信息：
</p>

<pre class="brush: bash">
git show 1e193e9a7bf1699392c6bbe3d53d786b93e6570b
</pre>

<p>
上面那个好长一串啊！其实只要前几个就行了（长到正好可以区分开来）：
</p>

<pre class="brush: bash">
git show 1e193e9
</pre>

<p>
也可以指定查看分支的名字：
</p>

<pre class="brush: bash">
git show master
git show experimenal
</pre>

<p>
查看本次提交的头信息。每一次commit都会有parent commit,可以使用<code>^</code>表示parent:
</p>

<pre class="brush: bash">
git show HEAD^  # 查看 HEAD 的父版本的信息 
git show HEAD^^ # 查看 HEAD 的父的父母的信息 
git show HEAD~4 # 查看 HEAD 上溯 4 代的信息
</pre>

<p>
要注意的是 git-merge 是会产生双父版本的,这种情况这样处理:
</p>

<pre class="brush: bash">
git show HEAD^1 # 查看 HEAD 的第一个父代
git show HEAD^2 # 查看 HEAD 的第二个父代
</pre>

<p>
可以用一个名字代替序列号（就是常说的“打TAG”啦～）：
</p>

<pre class="brush: bash">
git tag V1.0 c9d52de78c132f6ea420644c2b7e422b225d258f
git show V1.0
git branch stalbe V1.0 # 建立一个叫stalbe的分支
</pre>

<p>
查找文本：
</p>

<pre class="brush: bash">
git grep "ibus"      # 在所有版本口查找
git grep "ibus" V1.0 # 在V3版本中查找
</pre>

<p>
定位具体的历史记录。显示 V3 之后直至 V7 的所有历史记录：
</p>

<pre class="brush: bash">
git log V3..V7 
</pre>

<p>
显示所有 V3 之后的历史记录。
</p>

<pre class="brush: bash">
git log V3.. 
</pre>

<p>
注意<code>&lt;since&gt;..&lt;until&gt;</code>中任何一个被省略都将被默认设置为 HEAD。所以如果使用<code>..&lt;until&gt;</code>的话,git log 在大部分情况下会输出空的。
</p>

<p>
显示 2 周前到现在的所有历史记录。具体语法可查询git-ref-parse 命令的帮助文件。
</p>

<pre class="brush: bash">
git log –since=”2 weeks ago”
</pre>

<p>
将显示在 experimental分支，但不在stable分支的历史记录：
</p>

<pre class="brush: bash">
git log stable..experimental 
</pre>

<p>
将显示在stable分支但不在experimental分支的历史记录：
</p>

<pre class="brush: bash">
git log experimental..stable 
</pre>

<p>
将显示在experimental分支但不在stable分支的历史记录：
</p>

<pre class="brush: bash">
git log stable ..experimental
</pre>

<p>
gitk也可以定位具体的历史记录。将在GUI中显示自2周前到现在为止的，且位于drivers目录下的分支记录信息：
</p>

<pre class="brush: bash">
gitk –since=”2 weeks ago” drivers/ 
</pre>


</body>
</html>
