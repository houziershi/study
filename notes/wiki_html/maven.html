<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javascript" src="../../vimwiki-theme/code/theme/scripts/jquery-1.4.2.min.js"></script>

<link type="text/css" rel="stylesheet" href="../../vimwiki-theme/hightlight-code/styles/shCore.css"/>
<link type="text/css" rel="stylesheet" href="../../vimwiki-theme/hightlight-code/styles/shCoreRDark.css"/>
<link type="text/css" rel="stylesheet" href="../../vimwiki-theme/hightlight-code/styles/shThemeRDark.css"/>
<script type="text/javascript" src="../../vimwiki-theme/hightlight-code/scripts/shCore.js"></script>
<script type="text/javascript" src="../../vimwiki-theme/hightlight-code/scripts/shAutoloader.js"></script>

<link type="text/css" rel="stylesheet" href="../../vimwiki-theme/code/theme/styles/style.css" />

<script type="text/javascript" src="../../vimwiki-theme/code/theme/scripts/script.js"></script>


<title>Maven入门</title>
</head>
<body>
	<div class="note-main"> 


<h1>Maven入门</h1>
<div class="toc">
<ul>
<li><a href="#toc_1">配置</a>
<li><a href="#toc_2">建立工程</a>
<ul>
<li><a href="#toc_2.1">建立普通Java项目结构</a>
<li><a href="#toc_2.2">建立普通Java EE项目结构</a>
</ul>
<li><a href="#toc_3">项目构建</a>
<ul>
<li><a href="#toc_3.1">基本命令</a>
<li><a href="#toc_3.2">包依赖</a>
<ul>
<li><a href="#toc_3.2.1">检查包依赖</a>
<li><a href="#toc_3.2.2">导出所有jar包</a>
<li><a href="#toc_3.2.3">把源代码打成jar包</a>
</ul>
</ul>
<li><a href="#toc_4">发布web项目</a>
<ul>
<li><a href="#toc_4.1">Jetty插件</a>
</ul>
<li><a href="#toc_5">Hudson</a>
</ul>
</div>


<h1 id="toc_1">配置</h1>

<p>
环境变量<code>M2_HOME</code>指向安装根目录。
</p>

<p>
还有内存大小的分配：
</p>

<pre class="brush: bash">
set MAVEN_OPTS= -Xms128m -Xmx512m
</pre>

<p>
检查安装是否成功：
</p>

<pre class="brush: bash">
mvn -v
</pre>

<p>
如果有输出版本信息就安装正确。
</p>

<p>
初始化：
</p>

<pre class="brush: bash">
mvn help:system
</pre>

<h1 id="toc_2">建立工程</h1>

<h2 id="toc_2.1">建立普通Java项目结构</h2>

<pre class="brush: bash">
mvn archetype:generate
</pre>

<h2 id="toc_2.2">建立普通Java EE项目结构</h2>

<pre class="brush: bash">
mvn archetype:generate -DgroupId=hx.frame -DartifactId=frame-web -DarchetypeArtifactId=maven-archetype-webapp
</pre>

<h1 id="toc_3">项目构建</h1>

<h2 id="toc_3.1">基本命令</h2>

<pre class="brush: bash">
mvn clean
mvn validate
mvn compile
mvn test
mvn package
mvn install
mvn site
mvn depoly
</pre>

<h2 id="toc_3.2">包依赖</h2>

<h3 id="toc_3.2.1">检查包依赖</h3>
<p>
<code>mvn dependency:list</code>查看当前项目的已解析依赖
</p>

<p>
<code>mvn dependency:tree</code>查看当前项目的依赖树
</p>

<p>
<code>mvn dependency:analyze</code>分析当前项目的依赖状况，可以找到一些warning：
</p>

<ul>
<li>
使用了未声明的依赖

<li>
没有使用已声明的依赖（这些或许可以删掉，但是要仔细分析，像spring-core,spring-beans看起来是没有用到，但是他们是spring运行必须的） 

</ul>

<h3 id="toc_3.2.2">导出所有jar包</h3>

<p>
导出所有需要的jar包到lib目录下：
</p>
	
<pre class="brush: bash">
mvn dependency:copy-dependencies -DoutputDirectory=lib
</pre>

<h3 id="toc_3.2.3">把源代码打成jar包</h3>

<pre class="brush: bash">
mvn source:jar
</pre>

<h1 id="toc_4">发布web项目</h1>

<h2 id="toc_4.1">Jetty插件</h2>

<p>
这个插件可以启动一个jetty web服务器，启动速度喜人，一旦启动，修改了jsp，页面上可以直接反应出来，修改了servlet代码，运行一下<code>mvn compile</code>也可以立马反应出来，方便开发 
</p>

<p>
在pom.xml中这样配置： 
</p>

<pre class="brush: bash">
&lt;build&gt;
	&lt;finalName&gt;frame-web&lt;/finalName&gt;
	&lt;plugins&gt;
		&lt;plugin&gt;
		&lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;
		&lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
		&lt;version&gt;7.1.6.v20100715&lt;/version&gt;
		&lt;configuration&gt;
			&lt;scanIntervalSeconds&gt;3&lt;/scanIntervalSeconds&gt;
			&lt;webAppConfig&gt;
				&lt;contextPath&gt;/test&lt;/contextPath&gt;
			&lt;/webAppConfig&gt;
		&lt;/configuration&gt;
		&lt;/plugin&gt;
	&lt;/plugins&gt;
&lt;/build&gt;
</pre>

<p>
然后命令行运行：<code>mvn jetty:run</code>
访问一下：<code>localhost:8080/test/</code>就可以看到你的index.jsp了 
</p>


<h1 id="toc_5">Hudson</h1>

<p>
用 Hudson + Maven做持续集成，并不幸也遇到了类似的错误，那么上述两种方式都将不再起作用了，因为Hudson使用自己的maven-agent来启动Maven，不会去调用Maven的脚本，自然相应的配置也就无效了。
</p>

<p>
好在Hudson也给为我们提供了配置点，在Hudson的项目配置页面中，有一块Build区域，这里我们已经设置了Root Pom和Goals。注意该区域的右下角有一个"Advanced..."按钮，点击会看到MAVEN_OPTS输入框，这里输入"-Xmx512m"就OK了。
</p>
 </div>
</body>
</html>
