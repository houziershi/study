<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javascript" src="../../vimwiki-theme/code/theme/scripts/jquery-1.4.2.min.js"></script>

<link type="text/css" rel="stylesheet" href="../../vimwiki-theme/hightlight-code/styles/shCore.css"/>
<link type="text/css" rel="stylesheet" href="../../vimwiki-theme/hightlight-code/styles/shThemeDefault.css"/>
<script type="text/javascript" src="../../vimwiki-theme/hightlight-code/scripts/shCore.js"></script>
<script type="text/javascript" src="../../vimwiki-theme/hightlight-code/scripts/shAutoloader.js"></script>

<script type="text/javascript" src="../../vimwiki-theme/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<script type="text/javascript" src="../../vimwiki-theme/code/theme/scripts/script.js"></script>
<link type="text/css" rel="stylesheet" href="../../vimwiki-theme/code/theme/styles/style.css" />


<title>XMPP</title>
</head>
<body  onresize='changeTocSize()'>
	<div class="note-main"> 

<h1>XMPP</h1>
<div class="toc">
<ul>
<li><a href="#toc_1">JID</a>
<li><a href="#toc_2">STANZAS</a>
<ul>
<li><a href="#toc_2.1">常见属性</a>
<ul>
<li><a href="#toc_2.1.1">from</a>
<li><a href="#toc_2.1.2">to</a>
<li><a href="#toc_2.1.3">type</a>
<li><a href="#toc_2.1.4">id</a>
</ul>
<li><a href="#toc_2.2">常见片段</a>
<ul>
<li><a href="#toc_2.2.1">Presence</a>
<li><a href="#toc_2.2.2">Message</a>
</ul>
</ul>
</ul>
</div>

<h1 id="toc_1">JID</h1>

<p>
格式：<code>local@domain/resource</code>
</p>


<h1 id="toc_2">STANZAS</h1>

<pre class="brush: xml">
&lt;stream:stream&gt;

	&lt;iq type='get'&gt;
		&lt;query xmlns='jabber:iq:roster'/&gt;
	&lt;/iq&gt;
	
	&lt;presence/&gt;
	
	&lt;message type='chat'
		to='darcy@pemberley.lit' from='elizabaeth@longbourn.lit/ballroom'&gt;
		&lt;body&gt;I cannot talk of books in a ball-room; my head is always full of
		something else.&lt;/body&gt;
	&lt;/message&gt;
	
	&lt;presence type='unavailable'/&gt;

&lt;/stream:stream&gt;
</pre>

<h2 id="toc_2.1">常见属性</h2>

<h3 id="toc_2.1.1">from</h3>

<p>
不推荐发出消息设置from，一般由服务器设。如果from值不对服务器可能会拒绝信息。
</p>

<h3 id="toc_2.1.2">to</h3>

<p>
如果客户端到服务器中没有to，则被认为是发给服务器的。
</p>

<h3 id="toc_2.1.3">type</h3>

<p>
type如果为<code>error</code>，表示此类消息错误。不要回应<code>error</code>以避免错误消息在网络上循环。
</p>

<h3 id="toc_2.1.4">id</h3>

<p>
帮助识别响应。对<code>&lt;iq&gt;</code>来说是必须的。
</p>

<h2 id="toc_2.2">常见片段</h2>

<h3 id="toc_2.2.1">Presence</h3>

<p>
控制用户可见状态。
</p>

<ul>
<li>
<code>show</code>：状态

<li>
<code>status</code>：描述

<li>
<code>priority</code>：优先级，没有完整JID的目标应该发给多个resource上登录中的哪一个。
  范围：<code>-128</code>到<code>127</code>，默认为<code>0</code>。

<ul>
<li>
负值表示不收到明确指定给自己的消息。如果自己有一个resource上专门运行了一个
	  自动机器人服务的话，优先级可以用负值。

</ul>
</ul>

<pre class="brush: xml">
&lt;!-- 上线 --&gt;
&lt;presence/&gt;

&lt;!-- 下线 --&gt;
&lt;presence type='unavailable'/&gt;

&lt;!-- 状态与说明 --&gt;
&lt;presence&gt;
	&lt;show&gt;away&lt;/show&gt;
	&lt;status&gt;at the ball&lt;/status&gt;
&lt;/presence&gt;

&lt;!-- 说明与优先级 --&gt;
&lt;presence&gt;
	&lt;status&gt;touring the countryside&lt;/status&gt;
	&lt;priority&gt;10&lt;/priority&gt;
&lt;/presence&gt;

&lt;!-- 优先级 --&gt;
&lt;presence&gt;
	&lt;priority&gt;10&lt;/priority&gt;
&lt;/presence&gt;
</pre>

<h3 id="toc_2.2.2">Message</h3>


<pre class="brush: xml">
&lt;message from='bingley@netherfield.lit/drawing_room'
	to='darcy@pemberley.lit'
	type='chat'&gt;
	&lt;body&gt;Come, Darcy, I must have you dance.&lt;/body&gt;
	&lt;thread&gt;4fd61b376fbc4950b9433f031a5595ab&lt;/thread&gt;
&lt;/message&gt;

&lt;message from='bennets@chat.meryton.lit/mrs.bennet'
	to='mr.bennet@longbourn.lit/study'
	type='groupchat'&gt;
	&lt;body&gt;We have had a most delightful evening, a most excellent ball.&lt;/body&gt;
&lt;/message&gt;
</pre>

<p>
<code>type</code>属性是可选的，但推荐提供：
</p>
<ul>
<li>
<code>chat</code>：一对一

<li>
<code>error</code>：说明出错，地址不对、域名错误

<li>
<code>normal</code>：范围扩大出一对一的消息，很少见这种情况

<li>
<code>groupchat</code>：群聊

<li>
<code>headline</code>：一般是自动消息

</ul>

<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>


<pre class="brush: xml">
</pre>
 </div>
</body>
</html>
